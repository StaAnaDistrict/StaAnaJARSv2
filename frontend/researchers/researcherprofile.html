<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Researcher Profile - Sta. Ana JARS üè∫</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <style>
    body {
      margin: 0;
      background: #FBF7F1;
      font-family: 'Myriad Variable Concept', 'Myriad Pro', 'Segoe UI', Arial, sans-serif;
    }
    .navbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: #042A4A;
      padding: 0.5rem 2rem;
      position: relative;
    }
    .navbar-logo {
      height: 48px;
      width: auto;
    }
    .navbar-links {
      display: flex;
      align-items: center;
      gap: 2rem;
      list-style: none;
      margin: 0;
      padding: 0;
      margin-left: auto;
    }
    .navbar-links li {
      position: relative;
      display: flex;
      align-items: center;
    }
    .navbar-link {
      color: #fff;
      text-decoration: none;
      font-size: 1.1rem;
      font-weight: 400;
      letter-spacing: 0.02em;
      transition: opacity 0.2s;
      font-family: 'Myriad Variable Concept', 'Myriad Pro', 'Segoe UI', Arial, sans-serif;
      padding: 0.5rem 0.7rem;
      display: block;
    }
    .navbar-link:hover {
      opacity: 0.7;
    }
    .navbar-dropdown {
      display: none;
      position: absolute;
      top: 100%;
      left: 0;
      background: #042A4A;
      min-width: 180px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      border-radius: 0 0 0.5rem 0.5rem;
      z-index: 20;
      flex-direction: column;
      padding: 0.5rem 0;
      list-style: none;
      margin: 0;
    }
    .navbar-dropdown-link {
      color: #fff;
      text-decoration: none;
      padding: 0.7rem 1.2rem;
      font-size: 1rem;
      font-family: 'Myriad Variable Concept', 'Myriad Pro', 'Segoe UI', Arial, sans-serif;
      font-weight: 400;
      display: block;
      transition: background 0.2s;
      white-space: nowrap;
    }
    .navbar-dropdown-link:hover {
      background: #06477A;
    }
    .navbar-dropdown-parent:hover > .navbar-dropdown,
    .navbar-dropdown-parent:focus-within > .navbar-dropdown {
      display: flex;
    }
    .navbar-hamburger {
      display: none;
      flex-direction: column;
      justify-content: center;
      width: 32px;
      height: 32px;
      cursor: pointer;
      gap: 6px;
    }
    .navbar-hamburger span {
      display: block;
      height: 4px;
      width: 100%;
      background: #fff;
      border-radius: 2px;
      transition: 0.3s;
    }
    @media (max-width: 768px) {
      .navbar {
        padding: 0.5rem 1rem;
        position: relative;
      }
      .navbar-logo {
        height: 36px;
      }
      .navbar-links {
        flex-direction: column;
        gap: 0;
        width: 100%;
        display: none;
        position: absolute;
        top: 100%;
        right: 0;
        background: #042A4A;
        z-index: 100;
        box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        border-radius: 0 0 0.5rem 0.5rem;
      }
      .navbar-links.active {
        display: flex;
      }
      .navbar-links li {
        width: 100%;
        display: block;
      }
      .navbar-hamburger {
        display: flex;
      }
      .navbar-dropdown-parent {
        width: 100%;
      }
      .navbar-dropdown {
        position: static;
        box-shadow: none;
        border-radius: 0;
        min-width: 0;
        padding: 0;
        background: #06325A;
        display: none;
      }
      .navbar-dropdown-parent.open > .navbar-dropdown {
        display: flex;
      }
      .navbar-dropdown-link {
        padding: 0.7rem 2.2rem;
        font-size: 1rem;
        border-top: 1px solid rgba(255,255,255,0.08);
      }
    }
    .searchbar-section {
      width: 100%;
      background: #FBF7F1;
      display: flex;
      justify-content: flex-end;
      align-items: center;
      min-height: 4.5rem;
      position: relative;
      z-index: 2;
      border-bottom: 1px solid #e0e0e0;
    }
    .banner-search-container {
      position: relative;
      margin: 1.2rem 2.5rem 1.2rem 0;
      z-index: 3;
      display: flex;
      align-items: center;
    }
    .banner-search-btn {
      display: none;
      background: none;
      border: none;
      padding: 0.2rem;
      margin-right: 0.5rem;
      cursor: pointer;
      outline: none;
      align-items: center;
      justify-content: center;
    }
    .banner-search-btn svg {
      display: block;
    }
    .banner-search-input {
      font-family: 'Myriad Variable Concept', 'Myriad Pro', 'Segoe UI', Arial, sans-serif;
      font-size: 1.08rem;
      padding: 0.5rem 1.2rem;
      border-radius: 2rem;
      border: 1.5px solid #042A4A;
      outline: none;
      background: #FFFEEE;
      color: #042A4A;
      transition: border 0.2s, width 0.3s, opacity 0.3s, padding 0.3s;
      min-width: 220px;
      box-shadow: 0 2px 8px rgba(4,42,74,0.08);
      opacity: 1;
      width: 220px;
      display: block;
    }
    .banner-search-input:focus {
      border: 2px solid #06477A;
    }
    @media (max-width: 768px) {
      .banner-search-container {
        top: 0.7rem;
        right: 1.1rem;
      }
      .banner-search-btn {
        display: flex;
      }
      .banner-search-input {
        min-width: 0;
        width: 0;
        opacity: 0;
        padding: 0;
        pointer-events: none;
        transition: border 0.2s, width 0.3s, opacity 0.3s, padding 0.3s;
        font-size: 0.98rem;
      }
      .banner-search-container.expanded .banner-search-input {
        min-width: 120px;
        width: 120px;
        opacity: 1;
        padding: 0.4rem 0.8rem;
        pointer-events: auto;
      }
    }
    .research-box {
      background: #FBF7F0;
      border: 0.5pt solid #4F5559;
      border-radius: 1.1rem;
      box-shadow: 0 2px 8px rgba(4,42,74,0.04);
      padding: 2.2rem 2.5rem 2rem 2.5rem;
      width: calc(100% - 5rem);
      max-width: 1100px;
      margin: 2.5rem auto 2.5rem auto;
      font-size: 1.13rem;
      color: #052A4A;
      line-height: 1.7;
      font-family: 'Myriad Variable Concept', 'Myriad Pro', 'Segoe UI', Arial, sans-serif;
      font-weight: 400;
      box-sizing: border-box;
    }
    .profile-section {
      display: grid;
      grid-template-columns: 9fr 16fr;
      gap: 2.5rem;
      background: none;
      padding: 0;
      max-width: none;
      margin: 0;
      align-items: flex-start;
    }
    .profile-pic-container {
      display: flex;
      align-items: flex-start;
      justify-content: center;
      width: 100%;
      aspect-ratio: 9/16;
      background: #FFFEEE;
      border-radius: 1.1rem;
      box-shadow: 0 2px 8px rgba(4,42,74,0.08);
      overflow: hidden;
      min-width: 120px;
      max-width: 260px;
    }
    .profile-pic-container img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 1.1rem;
    }
    .profile-details {
      display: flex;
      flex-direction: column;
      gap: 0.7rem;
      width: 100%;
    }
    .profile-name {
      font-family: 'Century Old Style Std', 'Times New Roman', Times, serif;
      color: #042A4A;
      font-size: 1.5rem;
      font-weight: 600;
      margin-bottom: 0.3rem;
      line-height: 1.2;
    }
    .profile-label {
      font-family: 'Myriad Variable Concept', 'Myriad Pro', 'Segoe UI', Arial, sans-serif;
      font-weight: 700;
      color: #052A4A;
      font-size: 1.08rem;
      margin-right: 0.5rem;
    }
    .profile-value {
      font-family: 'Myriad Variable Concept', 'Myriad Pro', 'Segoe UI', Arial, sans-serif;
      font-weight: 400;
      color: #052A4A;
      font-size: 1.08rem;
    }
    .profile-row {
      display: flex;
      align-items: baseline;
      gap: 0.5rem;
    }
    ol.profile-published-list, ul.profile-recognitions-list {
      padding-left: 2.2rem;
      margin-top: 0.5rem;
      margin-bottom: 2rem;
    }
    @media (max-width: 900px) {
      .research-box {
        padding: 1.2rem 1rem 1rem 1rem;
        width: calc(100% - 2rem);
        max-width: none;
      }
      .profile-section {
        grid-template-columns: 1fr;
        gap: 1.5rem;
        padding: 0;
      }
    }
    .site-footer {
      background: #042A4A;
      color: #fff;
      padding: 2.2rem 1rem 1.5rem 1rem;
      text-align: center;
      font-family: 'Open Sans', Arial, sans-serif;
    }
    .footer-content {
      max-width: 900px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1.1rem;
    }
    .footer-copyright {
      font-size: 1.08rem;
      font-weight: 400;
      margin-bottom: 0.2rem;
    }
    .footer-links {
      display: flex;
      gap: 1.2rem;
      align-items: center;
      justify-content: center;
      flex-wrap: wrap;
    }
    .footer-link {
      color: #fff;
      text-decoration: none;
      font-size: 1.02rem;
      font-family: 'Open Sans', Arial, sans-serif;
      font-weight: 400;
      transition: opacity 0.2s;
    }
    .footer-link:hover {
      opacity: 0.7;
      text-decoration: underline;
    }
    .footer-sep {
      color: #fff;
      font-size: 1.1rem;
      opacity: 0.7;
    }
  </style>
</head>
<body>
  <nav class="navbar">
    <a href="../index.html" class="navbar-logo-link">
      <img src="/images/StaAnaJARSLogo.png" alt="Logo" class="navbar-logo">
    </a>
    <ul class="navbar-links" id="navbarLinks">
      <li><a href="../index.html" class="navbar-link">Home</a></li>
      <li><a href="/about.html" class="navbar-link">About</a></li>
      <li class="navbar-dropdown-parent">
        <a href="#" class="navbar-link navbar-dropdown-label" tabindex="0">Journal Issues</a>
        <ul class="navbar-dropdown">
            <li><a href="/action-research/school-based.html" class="navbar-dropdown-link">School-Based</a></li>
          <li><a href="/action-research/district-based.html" class="navbar-dropdown-link">District-Based</a></li>
          <li><a href="/action-research/division-based.html" class="navbar-dropdown-link">Division-Based</a></li>
          <li><a href="/action-research/berf-grantee.html" class="navbar-dropdown-link">BERF Grantee</a></li>
        </ul>
      </li>
      <li><a href="../submit-a-study.html" class="navbar-link">Submit a Study</a></li>
      <li><a href="../editorial.html" class="navbar-link">Editorial Board</a></li>
    </ul>
    <div class="navbar-hamburger" id="navbarHamburger" aria-label="Open navigation" tabindex="0">
      <span></span>
      <span></span>
      <span></span>
    </div>
  </nav>

  <!-- Search Bar Section -->
  <section class="searchbar-section">
    <div class="banner-search-container">
      <button id="bannerSearchBtn" class="banner-search-btn" aria-label="Open search"><svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="10" cy="10" r="7.5" stroke="#042A4A" stroke-width="2"/><line x1="16.0607" y1="16.3536" x2="20" y2="20.2929" stroke="#042A4A" stroke-width="2" stroke-linecap="round"/></svg></button>
      <input type="text" id="latestSearch" class="banner-search-input" placeholder="Search latest..." aria-label="Search latest studies">
    </div>
  </section>

  <!-- Add a results section at the top of the page -->
  <div id="search-results" style="margin: 2rem auto; max-width: 900px;"></div>

  <div class="research-box">
    <section class="profile-section">
      <div class="profile-pic-container" id="profilePicContainer">
        <!-- Profile picture will be inserted here -->
      </div>
      <div class="profile-details" id="profileDetails">
        <!-- Profile details will be inserted here -->
      </div>
    </section>
    <h3>Research Published</h3>
    <ol class="profile-published-list" id="profilePublishedList">
      <!-- Published research links will be inserted here -->
    </ol>
    <h3>Recognitions Received:</h3>
    <ul class="profile-recognitions-list" id="profileRecognitionsList">
      <!-- Recognitions will be inserted here -->
    </ul>
  </div>

  <footer class="site-footer">
    <div class="footer-content">
      <div class="footer-copyright">¬© 2025 Sta. Ana JARS. All rights reserved. Developed by Mr. Wedzmer Munjilul</div>
      <div class="footer-links">
        <a href="../privacy-policy.html" class="footer-link">Privacy Policy</a>
        <span class="footer-sep">|</span>
        <a href="../terms-of-use.html" class="footer-link">Terms of Use</a>
        <span class="footer-sep">|</span>
        <a href="../site-map.html" class="footer-link">Site Map</a>
      </div>
    </div>
  </footer>
  <script>
    // Hamburger menu toggle
    const hamburger = document.getElementById('navbarHamburger');
    const links = document.getElementById('navbarLinks');
    hamburger.addEventListener('click', () => {
      links.classList.toggle('active');
    });
    hamburger.addEventListener('keypress', (e) => {
      if (e.key === 'Enter' || e.key === ' ') {
        links.classList.toggle('active');
      }
    });
    // Dropdown for Journal Issues
    const dropdownParent = document.querySelector('.navbar-dropdown-parent');
    const dropdownLabel = dropdownParent.querySelector('.navbar-dropdown-label');
    function isMobile() {
      return window.innerWidth <= 768;
    }
    dropdownLabel.addEventListener('click', function(e) {
      if (isMobile()) {
        e.preventDefault();
        dropdownParent.classList.toggle('open');
      }
    });
    dropdownLabel.addEventListener('keypress', function(e) {
      if (isMobile() && (e.key === 'Enter' || e.key === ' ')) {
        e.preventDefault();
        dropdownParent.classList.toggle('open');
      }
    });
    window.addEventListener('resize', function() {
      dropdownParent.classList.remove('open');
    });
    // Search bar logic (from school-based.html)
    const bannerSearchBtn = document.getElementById('bannerSearchBtn');
    const bannerSearchInput = document.getElementById('latestSearch');
    const bannerSearchContainer = document.querySelector('.banner-search-container');
    function isMobile() {
      return window.innerWidth <= 768;
    }
    bannerSearchBtn.addEventListener('click', function() {
      if (isMobile()) {
        bannerSearchContainer.classList.add('expanded');
        bannerSearchInput.style.display = 'block';
        setTimeout(() => bannerSearchInput.focus(), 100);
      }
    });
    bannerSearchInput.addEventListener('blur', function() {
      if (isMobile() && !bannerSearchInput.value) {
        bannerSearchContainer.classList.remove('expanded');
        bannerSearchInput.style.display = '';
      }
    });
    window.addEventListener('resize', function() {
      if (!isMobile()) {
        bannerSearchContainer.classList.remove('expanded');
        bannerSearchInput.style.display = '';
      }
    });
    // Search submit redirects to search.html
    const bannerSearchForm = document.createElement('form');
    if (!bannerSearchContainer.querySelector('form')) {
      bannerSearchForm.className = 'banner-search-form';
      while (bannerSearchContainer.firstChild) {
        bannerSearchForm.appendChild(bannerSearchContainer.firstChild);
      }
      bannerSearchContainer.appendChild(bannerSearchForm);
    }
    bannerSearchForm.addEventListener('submit', async function(e) {
      e.preventDefault();
      const q = bannerSearchInput.value.trim();
      if (!q) return;
      const resultsDiv = document.getElementById('search-results');
      resultsDiv.innerHTML = '<div style="text-align:center; padding:2rem;">Searching...</div>';
      try {
        const response = await fetch(`/api/researches?search=${encodeURIComponent(q)}`);
        if (!response.ok) throw new Error('Failed to fetch research data');
        const data = await response.json();
        if (!data.researches.length) {
          resultsDiv.innerHTML = '<div style="text-align:center; padding:2rem;">No results found.</div>';
          return;
        }
        let html = '';
        data.researches.forEach(research => {
          const title = research.research_title || '';
          const category = research.category_name || '';
          const authors = research.authors || 'Unknown Author';
          const completionDate = `${research.completion_month || ''} ${research.completion_year || ''}`;
          const abstract = research.abstract || 'No description available.';
          const urlTitle = title.toLowerCase().replace(/[^a-z0-9\s-]/g, '').replace(/\s+/g, '-').replace(/-+/g, '-').trim();
          const researchUrl = `/action-research/${(research.type_name || '').toLowerCase().replace(/\s+/g, '-')}/${(research.type_name || '').toLowerCase().includes('school') ? 'schb' : (research.type_name || '').toLowerCase().includes('district') ? 'disb' : (research.type_name || '').toLowerCase().includes('division') ? 'divb' : 'berf'}-published-template.html?id=${research.research_id}&title=${encodeURIComponent(urlTitle)}`;
          html += `
            <div class="research-entry">
              <div class="research-title-text">
                <a href="${researchUrl}" class="read-more">${title}</a>
              </div>
              <div class="research-author">${authors}, ${completionDate}</div>
              <div class="research-description"><em>${abstract}</em></div>
              <div class="research-category">Category: ${category}</div>
              <a href="${researchUrl}" class="read-more">Read More</a>
            </div>
          `;
        });
        resultsDiv.innerHTML = html;
      } catch (error) {
        resultsDiv.innerHTML = '<div style="text-align:center; padding:2rem; color:#d32f2f;">Error loading search results.</div>';
      }
    });

    // --- DYNAMIC PROFILE LOGIC ---
    async function getResearcherId() {
      const params = new URLSearchParams(window.location.search);
      return params.get('id');
    }

    async function fetchResearcherProfile(id) {
      const res = await fetch(`/api/researchers/${id}`);
      if (!res.ok) throw new Error('Failed to fetch researcher profile');
      return await res.json();
    }
    async function fetchResearcherPublications(id) {
      const res = await fetch(`/api/researchers/${id}/publications`);
      if (!res.ok) throw new Error('Failed to fetch publications');
      return await res.json();
    }
    async function fetchResearcherRecognitions(id) {
      const res = await fetch(`/api/researchers/${id}/recognitions`);
      if (!res.ok) throw new Error('Failed to fetch recognitions');
      return await res.json();
    }

    function buildResearchUrl(research) {
      const type = (research.type_name || '').toLowerCase();
      let folder = '';
      if (type.includes('school')) folder = 'school-based';
      else if (type.includes('district')) folder = 'district-based';
      else if (type.includes('division')) folder = 'division-based';
      else folder = 'berf-grantee';
      const urlTitle = (research.research_title || '').toLowerCase().replace(/[^a-z0-9\s-]/g, '').replace(/\s+/g, '-').replace(/-+/g, '-').trim();
      const short = folder.startsWith('school') ? 'schb' : folder.startsWith('district') ? 'disb' : folder.startsWith('division') ? 'divb' : 'berf';
      return `/action-research/${folder}/${short}-published-template.html?id=${research.research_id}&title=${encodeURIComponent(urlTitle)}`;
    }

    function renderProfile(profile) {
      document.title = `${profile.last_name}, ${profile.first_name} - Sta. Ana JARS üè∫`;
      const picDiv = document.getElementById('profilePicContainer');
      const profilePic = profile.profile_picture ? ('/' + profile.profile_picture.replace(/^\/*/, '')) : '/researchers/profilepictures/NoProfilePicture.png';
      picDiv.innerHTML = `<img src="${profilePic}" alt="Profile Picture">`;
      const detailsDiv = document.getElementById('profileDetails');
      detailsDiv.innerHTML = `
        <div class="profile-name">${profile.last_name}, ${profile.first_name} ${profile.middle_name || ''}</div>
        <div class="profile-row"><span class="profile-label">Current Position:</span><span class="profile-value">${profile.position || ''}</span></div>
        <div class="profile-row"><span class="profile-label">School Affiliation:</span><span class="profile-value">${profile.school_affiliation || ''}</span></div>
        <div class="profile-row"><span class="profile-label">School Address:</span><span class="profile-value">${profile.school_address || ''}</span></div>
        <div class="profile-row"><span class="profile-label">Email Address:</span><span class="profile-value">${profile.email_address || ''}</span></div>
        <div class="profile-row"><span class="profile-label">Highest Degree Attained:</span><span class="profile-value">${profile.highest_degree_attained || ''}</span></div>
        <div class="profile-row"><span class="profile-label">Years in Service:</span><span class="profile-value">${profile.years_in_service || ''}</span></div>
      `;
    }

    function renderPublishedList(publications) {
      const publishedDiv = document.getElementById('profilePublishedList');
      if (!publications.length) {
        publishedDiv.innerHTML = '<li style="color:#888;">No research published yet.</li>';
        return;
      }
      publishedDiv.innerHTML = publications.map(pub => {
        const url = buildResearchUrl(pub);
        return `<li><a href="${url}">${pub.research_title}</a> <span style="color:#888;font-size:0.95em;">(${pub.completion_year || ''})</span></li>`;
      }).join('');
    }

    function renderRecognitions(recognitions) {
      const recDiv = document.getElementById('profileRecognitionsList');
      if (!recognitions.length) {
        recDiv.innerHTML = '<li style="color:#888;">No recognitions listed.</li>';
        return;
      }
      recDiv.innerHTML = recognitions.map(r => `<li>${r.recognition_name} (${r.awarding_body}, ${r.year_received})</li>`).join('');
    }

    async function loadProfile() {
      try {
        const id = await getResearcherId();
        if (!id) throw new Error('No researcher ID specified');
        const [profile, publications, recognitions] = await Promise.all([
          fetchResearcherProfile(id),
          fetchResearcherPublications(id),
          fetchResearcherRecognitions(id)
        ]);
        renderProfile(profile);
        renderPublishedList(publications);
        renderRecognitions(recognitions);
      } catch (err) {
        document.getElementById('profilePicContainer').innerHTML = '<div style="color:#d32f2f;">Error loading profile.</div>';
        document.getElementById('profileDetails').innerHTML = '';
        document.getElementById('profilePublishedList').innerHTML = '';
        document.getElementById('profileRecognitionsList').innerHTML = '';
      }
    }
    loadProfile();
  </script>
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
</body>
</html>